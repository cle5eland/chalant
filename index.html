<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Chalant Audio Cabling</title>
    <link rel="icon" type="image/svg+xml" href="assets/favicon.svg" sizes="any">
    <link rel="icon" type="image/png" href="assets/favicon.png">
    <link rel="apple-touch-icon" href="assets/favicon.png">
    <link rel="stylesheet" href="assets/styles.css">
  </head>
  <body>
    <div class="page">
      <h1>Chalant Audio Cabling</h1>
      <p class="subtle">Diagram with CSV-driven table below. Both responsive.</p>

      <div class="layout">
        <div class="panel img-panel">
          <img src="https://www.plantuml.com/plantuml/proxy?src=https://raw.githubusercontent.com/cle5eland/chalant/refs/heads/main/cables.puml" alt="Cables Diagram">
        </div>

        <div class="panel">
          <h2 style="margin:0 0 8px 0;">Cable Counts</h2>
          <p class="subtle" style="margin-top:0;">Loaded from <code>cable_counts.csv</code>.</p>

          <table id="cable-table">
            <thead>
              <tr>
                <th>Cable Type</th>
                <th>Count</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
          <div id="csv-error" class="error" style="display:none;">Could not load <code>cable_counts.csv</code>. If opening this file directly, serve via a local HTTP server.</div>
        </div>
      </div>
    </div>

    <script>
      (function () {
        const csvUrl = 'cable_counts.csv';
        const colorMap = {
          'Normal XLR': '#2ECC71',
          'Long XLR (50 ft)': '#3498DB',
          'Long XLR + adapter': '#E67E22',
          'Short XLR + adapter': '#9B59B6'
        };

        function parseCsv(text) {
          const lines = text.trim().split(/\r?\n/).filter(Boolean);
          if (!lines.length) return [];
          const headers = lines[0].split(',').map(s => s.replace(/^"|"$/g, '').trim());
          return lines.slice(1).map(line => {
            const cols = line.split(',').map(s => s.replace(/^"|"$/g, '').trim());
            const obj = {};
            headers.forEach((h, i) => (obj[h] = cols[i]));
            return obj;
          });
        }

        function renderTable(rows) {
          const tbody = document.querySelector('#cable-table tbody');
          tbody.innerHTML = '';
          rows.forEach(r => {
            const tr = document.createElement('tr');
            const tdType = document.createElement('td');
            const tdCount = document.createElement('td');
            const color = colorMap[r.cable_type] || '#888';

            const swatch = document.createElement('span');
            swatch.className = 'swatch';
            swatch.style.background = color;

            tdType.appendChild(swatch);
            tdType.appendChild(document.createTextNode(r.cable_type));
            tdCount.textContent = r.count;
            tr.appendChild(tdType);
            tr.appendChild(tdCount);
            tbody.appendChild(tr);
          });
        }

        fetch(csvUrl)
          .then(r => { if (!r.ok) throw new Error('HTTP ' + r.status); return r.text(); })
          .then(text => parseCsv(text))
          .then(rows => {
            rows = rows.map(r => ({
              cable_type: r.cable_type || r.Cable_Type || r.type || r.Type,
              count: r.count || r.Count || r.quantity || r.Quantity
            })).filter(r => r.cable_type && r.count != null);
            renderTable(rows);
          })
          .catch(err => {
            console.error('Failed to load CSV:', err);
            document.getElementById('csv-error').style.display = 'block';
          });
      })();
    </script>
  </body>
  </html>
